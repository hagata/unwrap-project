
var fs = require('fs');
var persistFile = fs.readFileSync('./persist.json');
var persistData = JSON.parse(persistFile);

/**
 * List Command returns the list of projects
 * @return {array} Returns the list of project names
 */
module.exports.list = function(option) {

  console.log('Projects: ');
  for (index in persistData.projects){
    var projecetName = persistData.projects[index].project;
    var projectDirectory = persistData.projects[index].directory;

    if (option == 'dir'){
      console.log(' - ' + projecetName + ' | ' + projectDirectory);
    }else{
      console.log(" - " + projecetName)
    }
  }
}


/**
 * Accesses and parses the persistData json file
 * @return {object} the json object from persist.json
 */
module.exports.readPersist = function() {
  return persistData;
}

module.exports.add = function(projectName, directory) {

  //Check if a directory is supplied, otherwise set the current directory 
  if (!directory){
    directory = process.cwd()
  }
  
  var newProject = {
    "project": projectName,
    "directory": directory
  }

  //TODO: Prompt for confirmation?
  persistData.projects.push(newProject)
  this.writePersist(persistData);

  console.log('Added - ' + projectName);
  
}

module.exports.remove = function(projectName) {
  console.log('Removing Projectâ€¦ \"' + projectName + '\"\n');
  //does that proj exist?
  var findProject = function(find) {
    return find.project;
  }
  var projectIndex = persistData.projects.map(findProject).indexOf(projectName);

  //if so, remove it
  if(projectIndex > -1){
    persistData.projects.splice(projectIndex, 1)
    this.writePersist(persistData);
  }else{
   console.log(' - \"' + projectName + '\"" does not exist.');
 }
};

module.exports.writePersist = function(updatedData) {
  var writePersist = JSON.stringify(updatedData, null, 2);
  fs.writeFileSync('./persist.json', writePersist);
}
